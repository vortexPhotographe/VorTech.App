<UserControl x:Class="VorTech.App.Views.ArticlesView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             Background="Transparent"
             Loaded="UserControl_Loaded">
    <Grid Margin="8" Background="Transparent">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Toolbar -->
        <!-- Toolbar + statut -->
        <Grid Grid.Row="0" Margin="0,0,0,8" Background="Transparent">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Boutons -->
            <StackPanel Orientation="Horizontal" Background="Transparent">
                <Button x:Name="BtnNew"       Content="Nouveau"     Click="BtnNew_Click"       Margin="0,0,8,0"/>
                <Button x:Name="BtnSave"      Content="Enregistrer" Click="BtnSave_Click"      Margin="0,0,8,0"/>
                <Button x:Name="BtnDelete"    Content="Supprimer"   Click="BtnDelete_Click"    Margin="0,0,8,0"/>
                <Button x:Name="BtnReload"    Content="Recharger"   Click="BtnReload_Click"/>
            </StackPanel>

            <!-- Statut OK -->
            <Border Grid.Column="2"
          x:Name="StatusPanelOk"
          Visibility="Collapsed"
          Padding="10,6"
          CornerRadius="4"
          Background="{StaticResource HeaderBg}"
          BorderBrush="{StaticResource Border}"
          BorderThickness="1"
          Margin="8,0,0,0">
                <StackPanel Orientation="Horizontal" Background="Transparent">
                    <TextBlock x:Name="StatusOkText"
                 Foreground="{StaticResource Fore}"
                 FontWeight="SemiBold"
                 Text="Enregistré ✓"/>
                </StackPanel>
            </Border>

            <!-- Statut Erreur -->
            <Border Grid.Column="2"
          x:Name="StatusPanelErr"
          Visibility="Collapsed"
          Padding="10,6"
          CornerRadius="4"
          Background="{StaticResource HeaderBg}"
          BorderBrush="{StaticResource Accent}"
          BorderThickness="1"
          Margin="8,0,0,0">
                <StackPanel Orientation="Horizontal" Background="Transparent">
                    <TextBlock x:Name="StatusErrText"
                 Foreground="{StaticResource Accent}"
                 FontWeight="SemiBold"
                 Text="Erreur"/>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Corps -->
        <Grid Grid.Row="1" Background="Transparent">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="12"/>
                <ColumnDefinition Width="2.8*" />
            </Grid.ColumnDefinitions>

            <!-- Liste Articles -->
            <GroupBox Header="Articles" Grid.Column="0"
                Background="Transparent" BorderThickness="1" Padding="4" Margin="0"
                SnapsToDevicePixels="True">
                <Grid Background="Transparent">
                    <DataGrid x:Name="GridArticles"
                    AutoGenerateColumns="False"
                    IsReadOnly="True"
                    SelectionMode="Single"
                    SelectionChanged="GridArticles_SelectionChanged"
                    Margin="0"
                    Background="Transparent"
                    BorderThickness="0">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Id"      Binding="{Binding Id}"          Width="60"/>
                            <DataGridTextColumn Header="Code"    Binding="{Binding Code}"        Width="*"/>
                            <DataGridTextColumn Header="Libellé" Binding="{Binding Libelle}"     Width="2*"/>
                            <DataGridTextColumn Header="PU HT"   Binding="{Binding PrixVenteHT}" Width="120" />
                            <DataGridTextColumn Header="Stock"   Binding="{Binding StockActuel}" Width="100"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </GroupBox>

            <!-- Fiche article -->
            <GroupBox Grid.Column="2" Header="Fiche article"
                  Background="Transparent" BorderThickness="1" Padding="4" Margin="0"
                  SnapsToDevicePixels="True"
                  HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch"> 
                <Grid Margin="0" Background="Transparent">
                    <TabControl Padding="0" Margin="0" Background="Transparent" BorderThickness="0">
                        <TabControl.Resources>
                            <Style TargetType="TabItem">
                                <Setter Property="Foreground" Value="{StaticResource Fore}"/>
                                <Setter Property="Background" Value="{StaticResource Panel}"/>
                                <Setter Property="Padding" Value="12,6"/>
                                <Setter Property="Margin" Value="0,0,6,0"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="TabItem">
                                            <Border x:Name="Bd"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{StaticResource Border}"
                                BorderThickness="1"
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                                                <ContentPresenter ContentSource="Header"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsSelected" Value="True">
                                                    <Setter TargetName="Bd" Property="Background" Value="{StaticResource Panel}"/>
                                                    <Setter Property="Foreground" Value="{StaticResource Fore}"/>
                                                </Trigger>
                                                <Trigger Property="IsEnabled" Value="False">
                                                    <Setter Property="Opacity" Value="0.6"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </TabControl.Resources>
                        <!-- Onglet 1 : Fiche -->
                        <TabItem Header="Fiche" Background="Transparent" BorderThickness="0">
						  <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Background="Transparent" Padding="0" Margin="0">
							<!-- SharedSizeScope pour aligner les colonnes gauche/droite -->
							<Grid Margin="12" Background="Transparent" Grid.IsSharedSizeScope="True">
							  <Grid.ColumnDefinitions>
								<!-- Forme sur 2 colonnes: libellé/champ | libellé/champ | filler | panneau images -->
								<ColumnDefinition Width="Auto"  SharedSizeGroup="lbl"/>
								<ColumnDefinition Width="260"  SharedSizeGroup="fld"/>
								<ColumnDefinition Width="24"/>
								<ColumnDefinition Width="Auto"  SharedSizeGroup="lbl"/>
								<ColumnDefinition Width="260"  SharedSizeGroup="fld"/>
								<ColumnDefinition Width="*"/>
								<ColumnDefinition Width="280"/>
							  </Grid.ColumnDefinitions>

							  <!-- lignes du formulaire -->
							  <Grid.RowDefinitions>
								<RowDefinition Height="Auto"/>
								<RowDefinition Height="Auto"/>
								<RowDefinition Height="Auto"/>
								<RowDefinition Height="Auto"/>
								<RowDefinition Height="Auto"/>
								<RowDefinition Height="Auto"/>
								<RowDefinition Height="Auto"/>
								<RowDefinition Height="Auto"/>
								<RowDefinition Height="Auto"/>
								<RowDefinition Height="Auto"/>
							  </Grid.RowDefinitions>

							  <!-- Colonne IMAGES (droite) -->
							  <GroupBox Grid.Column="6" Grid.RowSpan="10" Header="Images (0..4)"
										Background="Transparent" Padding="8" Margin="0"
										BorderThickness="1">
								<StackPanel Background="Transparent">
								  <Button Content="Ajouter image" Click="BtnAddImage_Click" />
								</StackPanel>
							  </GroupBox>

							  <!-- Lignes G/D (espacement vertical uniforme via Margin Top = 6) -->

							  <!-- Code -->
							  <Label Grid.Row="0" Grid.Column="0" Content="Code" VerticalAlignment="Center" Margin="0,0,8,0"/>
							  <TextBox x:Name="CodeBox" Grid.Row="0" Grid.Column="1" MinHeight="28"/>
							  <Label Grid.Row="0" Grid.Column="3" Content="" /> <!-- vide pour garder la grille propre -->

							  <!-- Libellé (champ large) -->
							  <Label Grid.Row="1" Grid.Column="0" Content="Libellé" VerticalAlignment="Center" Margin="0,6,8,0"/>
							  <TextBox x:Name="LibelleBox" Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="4" MinHeight="28" Margin="0,6,0,0"/>

							  <!-- Type -->
							  <Label Grid.Row="2" Grid.Column="0" Content="Type" VerticalAlignment="Center" Margin="0,6,8,0"/>
							  <StackPanel Grid.Row="2" Grid.Column="1" Orientation="Horizontal" Margin="0,6,0,0">
								<RadioButton x:Name="TypeArticleRadio" Content="Article" GroupName="TypeA" Checked="TypeRadio_Checked" Margin="0,0,12,0"/>
								<RadioButton x:Name="TypePackRadio"    Content="Pack"    GroupName="TypeA" Checked="TypeRadio_Checked"/>
							  </StackPanel>

							  <!-- Catégorie / Cotisation -->
							  <Label Grid.Row="3" Grid.Column="0" Content="Catégorie" VerticalAlignment="Center" Margin="0,6,8,0"/>
							  <ComboBox x:Name="CategorieBox" Grid.Row="3" Grid.Column="1" MinHeight="28" Margin="0,6,0,0"
										Style="{StaticResource ComboBox.Dark.Flat}"
										ItemContainerStyle="{DynamicResource ComboBoxItem.Dark}"
										DisplayMemberPath="Name" SelectedValuePath="Id"/>
							  <Label Grid.Row="3" Grid.Column="3" Content="Cotisation" VerticalAlignment="Center" Margin="0,6,8,0"/>
							  <ComboBox x:Name="CotisationBox" Grid.Row="3" Grid.Column="4" MinHeight="28" Margin="0,6,0,0"
										Style="{StaticResource ComboBox.Dark.Flat}"
										ItemContainerStyle="{DynamicResource ComboBoxItem.Dark}"
										DisplayMemberPath="Name" SelectedValuePath="Id"
										SelectionChanged="CotisationBox_SelectionChanged"/>

							  <!-- TVA / Prix vente HT -->
							  <Label Grid.Row="4" Grid.Column="0" Content="TVA" VerticalAlignment="Center" Margin="0,6,8,0"/>
							  <ComboBox x:Name="TvaBox" Grid.Row="4" Grid.Column="1" MinHeight="28" Margin="0,6,0,0"
										IsEnabled="False"
										Style="{StaticResource ComboBox.Dark.Flat}"
										ItemContainerStyle="{DynamicResource ComboBoxItem.Dark}"
										DisplayMemberPath="Name" SelectedValuePath="Id"
										SelectionChanged="TvaBox_SelectionChanged"/>
							  <Label Grid.Row="4" Grid.Column="3" Content="Prix vente HT" VerticalAlignment="Center" Margin="0,6,8,0"/>
							  <TextBox x:Name="PrixVenteBox" Grid.Row="4" Grid.Column="4" MinHeight="28" Margin="0,6,0,0"/>

							  <!-- Prix achat HT / Poids -->
							  <Label Grid.Row="5" Grid.Column="0" Content="Prix achat HT" VerticalAlignment="Center" Margin="0,6,8,0"/>
							  <TextBox x:Name="PrixAchatBox" Grid.Row="5" Grid.Column="1" MinHeight="28" Margin="0,6,0,0"/>
							  <Label Grid.Row="5" Grid.Column="3" Content="Poids (g)" VerticalAlignment="Center" Margin="0,6,8,0"/>
							  <TextBox x:Name="PoidsBox" Grid.Row="5" Grid.Column="4" MinHeight="28" Margin="0,6,0,0"/>

							  <!-- Prix conseillé (label en gras) -->
							  <Label Grid.Row="6" Grid.Column="0" Content="Prix conseillé..." VerticalAlignment="Center" Margin="0,6,8,0"/>
							  <TextBlock x:Name="PrixConseilleLabel" Grid.Row="6" Grid.Column="1" Margin="0,6,0,0" FontWeight="Bold" />

							  <!-- Stock / Seuil alerte -->
							  <Label Grid.Row="7" Grid.Column="0" Content="Stock actuel" VerticalAlignment="Center" Margin="0,6,8,0"/>
							  <TextBox x:Name="StockBox" Grid.Row="7" Grid.Column="1" MinHeight="28" Margin="0,6,0,0"/>
							  <Label Grid.Row="7" Grid.Column="3" Content="Seuil alerte" VerticalAlignment="Center" Margin="0,6,8,0"/>
							  <TextBox x:Name="SeuilBox" Grid.Row="7" Grid.Column="4" MinHeight="28" Margin="0,6,0,0"/>

							  <!-- Actif / Dernière MAJ -->
							  <CheckBox x:Name="ActifBox" Grid.Row="8" Grid.Column="1" Content="Actif" Margin="0,6,0,0" VerticalAlignment="Center"/>
							  <Label Grid.Row="8" Grid.Column="3" Content="Dernière MAJ :" VerticalAlignment="Center" Margin="0,6,8,0"/>
							  <TextBlock x:Name="DerniereMajLabel" Grid.Row="8" Grid.Column="4" Margin="0,6,0,0" VerticalAlignment="Center"/>

							  <!-- Code-barres + bouton générer aligné -->
							  <Label Grid.Row="9" Grid.Column="0" Content="Code-barres" VerticalAlignment="Center" Margin="0,6,8,0"/>
							  <Grid Grid.Row="9" Grid.Column="1" Grid.ColumnSpan="4" Margin="0,6,0,0">
								<Grid.ColumnDefinitions>
								  <ColumnDefinition Width="*"/>
								  <ColumnDefinition Width="140"/>
								</Grid.ColumnDefinitions>
								<TextBox x:Name="BarcodeBox" Grid.Column="0" MinHeight="28"/>
								<Button Grid.Column="1" Content="Générer EAN-13" Margin="8,0,0,0" Click="BtnGenBarcode_Click"/>
							  </Grid>
							</Grid>
						  </ScrollViewer>
						</TabItem>
                        <!-- Onglet 2 : Déclinaisons & Pack -->
                        <TabItem Header="Déclinaisons &amp; Pack" Background="{x:Null}" BorderThickness="0">
                            <Grid Margin="8" Background="Transparent">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="16"/>
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <GroupBox Header="Déclinaisons" Grid.Column="0"
                          Background="Transparent" BorderThickness="1" Padding="6">
                                    <DockPanel LastChildFill="True">
                                        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,6">
                                            <Button Content="Ajouter"   Click="BtnAddVariant_Click"    Margin="0,0,8,0"/>
                                            <Button Content="Supprimer" Click="BtnRemoveVariant_Click"/>
                                        </StackPanel>
                                        <DataGrid x:Name="GridVariants"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              SelectionMode="Single"
                              Background="Transparent"
                              BorderThickness="0">
                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="Nom"         Binding="{Binding Nom}"          Width="2*"/>
                                                <DataGridTextColumn Header="PU HT"       Binding="{Binding PrixVenteHT}"  Width="*"/>
                                                <DataGridTextColumn Header="Code-barres" Binding="{Binding CodeBarres}"   Width="2*"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </DockPanel>
                                </GroupBox>

                                <GroupBox Header="Pack (si Type=Pack)" Grid.Column="2"
                          Background="Transparent" BorderThickness="1" Padding="6">
                                    <Grid Background="Transparent">
                                        <TextBlock Text="Sélectionne les articles composants et leur quantité." Margin="0,0,0,6"/>
                                        <DataGrid x:Name="GridPack"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              SelectionMode="Single"
                              Background="Transparent"
                              BorderThickness="0">
                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="ArticleId" Binding="{Binding ArticleItemId}" Width="*"/>
                                                <DataGridTextColumn Header="Quantité"  Binding="{Binding Quantite}"      Width="*"/>
                                            </DataGrid.Columns>
                                        </DataGrid>
                                    </Grid>
                                </GroupBox>
                            </Grid>
                        </TabItem>
                    </TabControl>
                </Grid>
            </GroupBox>
        </Grid>
    </Grid>
</UserControl>

<UserControl x:Class="VorTech.App.Views.ClientsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             HorizontalContentAlignment="Stretch"
             VerticalContentAlignment="Stretch"
             d:DesignHeight="600" d:DesignWidth="1200">

  <!-- Grille externe : gauche fixe, séparateur, zone principale élastique -->
  <Grid Margin="12">
    <Grid.ColumnDefinitions>
      <ColumnDefinition Width="340"/>
      <ColumnDefinition Width="16"/>
      <ColumnDefinition Width="*"/>
    </Grid.ColumnDefinitions>

    <!-- ===== Colonne GAUCHE : liste clients ===== -->
    <GroupBox Grid.Column="0" Header="Clients"
              HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
      <Border Style="{StaticResource Card}">
        <ListBox ItemsSource="{Binding Clients}"
                 SelectedItem="{Binding SelectedClient, Mode=TwoWay}"
                 Background="{StaticResource Panel}"
                 BorderBrush="{StaticResource Border}"
                 BorderThickness="1"
                 Padding="8">
          <ListBox.ItemTemplate>
            <DataTemplate>
              <StackPanel Margin="0,6">
                <TextBlock Text="{Binding Nom}" FontWeight="SemiBold"/>
                <TextBlock Text="{Binding Prenom}" Foreground="{StaticResource Subtle}"/>
                <TextBlock Text="{Binding NomTeam}" FontStyle="Italic" Foreground="{StaticResource Subtle}"/>
              </StackPanel>
            </DataTemplate>
          </ListBox.ItemTemplate>
        </ListBox>
      </Border>
    </GroupBox>

    <!-- ===== Zone principale : Fiche ( * ) | Raccourcis ( Auto ) ===== -->
    <Grid Grid.Column="2" HorizontalAlignment="Stretch">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*"/>
        <ColumnDefinition Width="16"/>
        <ColumnDefinition Width="Auto"/>
      </Grid.ColumnDefinitions>

      <!-- Fiche client -->
	<GroupBox Grid.Column="0" Header="Fiche client"
			  HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
	  <ScrollViewer x:Name="FicheScroll"
					VerticalScrollBarVisibility="Auto"
					HorizontalScrollBarVisibility="Disabled">
                    <Grid Margin="6"
            Width="{Binding ElementName=FicheScroll, Path=ViewportWidth}">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <!-- barre d'actions -->
                            <RowDefinition Height="12"/>
                            <!-- espace -->
                            <RowDefinition Height="Auto"/>
                            <!-- formulaire (dans Border) -->
                            <RowDefinition Height="Auto"/>
                            <!-- emails envoyés (GroupBox) -->
                        </Grid.RowDefinitions>
                        <!-- Barre d'actions -->
                        <StackPanel Orientation="Horizontal" Grid.Row="0">
                            <Button Content="Nouveau" Click="New_Click"/>
                            <Button Content="Enregistrer" Click="Save_Click"/>
                            <Button Content="Supprimer" Click="Delete_Click"/>
                            <Button Content="Recharger" Click="Reload_Click"/>
                        </StackPanel>
                        <Border Grid.Row="1" Height="12" Background="Transparent"/>
                        <!-- Formulaire (dans une carte) -->
                        <Border Grid.Row="2" Style="{StaticResource Card}" DataContext="{Binding SelectedClient}">
                            <!-- ===== FICHE CLIENT : labels à gauche des champs ===== -->
                            <Grid Margin="0,8,0,0" Grid.IsSharedSizeScope="True">
                                <!-- 5 colonnes : lib1 | champ1 | gouttière | lib2 | champ2 -->
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" SharedSizeGroup="Label"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="24"/>
                                    <!-- gouttière -->
                                    <ColumnDefinition Width="Auto" SharedSizeGroup="Label"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- 7 lignes -->
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <!-- Société | SIRET -->
                                    <RowDefinition Height="Auto"/>
                                    <!-- Nom | Prénom -->
                                    <RowDefinition Height="Auto"/>
                                    <!-- Nom de team (full) -->
                                    <RowDefinition Height="Auto"/>
                                    <!-- Adresse (full) -->
                                    <RowDefinition Height="Auto"/>
                                    <!-- Code postal | Ville -->
                                    <RowDefinition Height="Auto"/>
                                    <!-- Email | Téléphone -->
                                    <RowDefinition Height="*"/>
                                    <!-- Notes (full) -->
                                </Grid.RowDefinitions>

                                <!-- Société | SIRET -->
                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Société"  Margin="0,4,8,4" VerticalAlignment="Center"/>
                                <TextBox   Grid.Row="0" Grid.Column="1" Text="{Binding Societe}"  Margin="0,4,0,4"/>
                                <TextBlock Grid.Row="0" Grid.Column="3" Text="SIRET"    Margin="0,4,8,4" VerticalAlignment="Center"/>
                                <TextBox   Grid.Row="0" Grid.Column="4" Text="{Binding Siret}"    Margin="0,4,0,4"/>

                                <!-- Nom | Prénom -->
                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Nom"      Margin="0,4,8,4" VerticalAlignment="Center"/>
                                <TextBox   Grid.Row="1" Grid.Column="1" Text="{Binding Nom}"      Margin="0,4,0,4"/>
                                <TextBlock Grid.Row="1" Grid.Column="3" Text="Prénom"   Margin="0,4,8,4" VerticalAlignment="Center"/>
                                <TextBox   Grid.Row="1" Grid.Column="4" Text="{Binding Prenom}"   Margin="0,4,0,4"/>

                                <!-- Nom de team (plein largeur) -->
                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Nom de team" Margin="0,4,8,4" VerticalAlignment="Center"/>
                                <TextBox   Grid.Row="2" Grid.Column="1" Grid.ColumnSpan="4" Text="{Binding NomTeam}" Margin="0,4,0,4"/>

                                <!-- Adresse (plein largeur) -->
                                <TextBlock Grid.Row="3" Grid.Column="0" Text="Adresse"   Margin="0,4,8,4" VerticalAlignment="Center"/>
                                <TextBox   Grid.Row="3" Grid.Column="1" Grid.ColumnSpan="4" Text="{Binding Adresse}" Margin="0,4,0,4"/>

                                <!-- Code postal | Ville -->
                                <TextBlock Grid.Row="4" Grid.Column="0" Text="Code postal" Margin="0,4,8,4" VerticalAlignment="Center"/>
                                <TextBox   Grid.Row="4" Grid.Column="1" Text="{Binding CodePostal}" Margin="0,4,0,4"/>
                                <TextBlock Grid.Row="4" Grid.Column="3" Text="Ville"        Margin="0,4,8,4" VerticalAlignment="Center"/>
                                <TextBox   Grid.Row="4" Grid.Column="4" Text="{Binding Ville}"      Margin="0,4,0,4"/>

                                <!-- Email | Téléphone -->
                                <TextBlock Grid.Row="5" Grid.Column="0" Text="Email"     Margin="0,4,8,4" VerticalAlignment="Center"/>
                                <TextBox   Grid.Row="5" Grid.Column="1" Text="{Binding Email}"      Margin="0,4,0,4"/>
                                <TextBlock Grid.Row="5" Grid.Column="3" Text="Téléphone" Margin="0,4,8,4" VerticalAlignment="Center"/>
                                <TextBox   Grid.Row="5" Grid.Column="4" Text="{Binding Telephone}"  Margin="0,4,0,4"/>

                                <!-- Notes (plein largeur) -->
                                <TextBlock Grid.Row="6" Grid.Column="0" Text="Notes" Margin="0,4,8,0" VerticalAlignment="Top"/>
                                <TextBox   Grid.Row="6" Grid.Column="1" Grid.ColumnSpan="4"
                                    Text="{Binding Notes}" AcceptsReturn="True" TextWrapping="Wrap" MinHeight="120" Margin="0,4,0,0"/>
                            </Grid>
                        </Border>
                        <!-- Emails envoyés (en dehors du Border, même Grid parent, ligne 3) -->
                        <GroupBox Grid.Row="3" Header="Emails envoyés au client" Margin="0,12,0,0">
                            <DataGrid x:Name="GridEmails"
                                AutoGenerateColumns="False"
                                IsReadOnly="True"
                                MouseDoubleClick="GridEmails_MouseDoubleClick">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Date"   Binding="{Binding SentAt, StringFormat=d}" Width="140"/>
                                    <DataGridTextColumn Header="Sujet"  Binding="{Binding Subject}" Width="*"/>
                                    <DataGridTextColumn Header="À"      Binding="{Binding ToAddress}" Width="220"/>
                                    <DataGridTextColumn Header="Statut" Binding="{Binding Status}" Width="120"/>
                                    <DataGridTextColumn Header="Pièces" Binding="{Binding Attachments}" Width="180"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </GroupBox>

                    </Grid>
              </ScrollViewer>
            </GroupBox>

      <!-- Séparateur -->
      <Border Grid.Column="1" Width="16" Background="Transparent"/>

      <!-- Raccourcis : largeur auto bornée -->
      <GroupBox Grid.Column="2" Header="Raccourcis"
                HorizontalAlignment="Left" HorizontalContentAlignment="Stretch"
                MinWidth="260" MaxWidth="360">
        <StackPanel Margin="6">
          <Button Content="Nouveau devis" Click="Shortcut_NewDevis_Click" Margin="0,0,0,6"/>
          <Button Content="Nouvelle facture" Click="Shortcut_NewFacture_Click" Margin="0,0,0,6"/>
          <Button Content="Devis du client" Click="Shortcut_DevisClient_Click" Margin="0,0,0,6"/>
          <Button Content="Factures du client" Click="Shortcut_FacturesClient_Click" Margin="0,0,0,6"/>
          <Button Content="Parc radios" Click="Shortcut_ParcRadios_Click" Margin="0,0,0,6"/>
          <Button Content="Cartes SIM" Click="Shortcut_CartesSim_Click" Margin="0,0,0,6"/>
          <Button Content="Frequences UHF" Click="Shortcut_FreqUhf_Click"/>
        </StackPanel>
      </GroupBox>
    </Grid>
  </Grid>
</UserControl>
